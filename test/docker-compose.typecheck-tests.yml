version: "3.8"

services:
  typecheck-grapl-analyzerlib:
    image: grapl/grapl-analyzerlib-test:${TAG:-latest}
    build:
      context: ${PWD}/src
      dockerfile: ./python/Dockerfile
      target: grapl-analyzerlib-test
    command: |
      /bin/bash -c "
        source venv/bin/activate &&
        cd grapl_analyzerlib &&
        pip install '.[typecheck]' &&
        pytype --config ./pytype.cfg .
        "
